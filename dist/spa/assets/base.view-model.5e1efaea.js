import{api as W}from"./axios.4c6579cc.js";import{aS as m,k as B,S,aT as b,ax as G}from"./index.3c48b6f7.js";var H=function(){function n(t){this.groups=[],this.each=!1,this.context=void 0,this.type=t.type,this.name=t.name,this.target=t.target,this.propertyName=t.propertyName,this.constraints=t==null?void 0:t.constraints,this.constraintCls=t.constraintCls,this.validationTypeOptions=t.validationTypeOptions,t.validationOptions&&(this.message=t.validationOptions.message,this.groups=t.validationOptions.groups,this.always=t.validationOptions.always,this.each=t.validationOptions.each,this.context=t.validationOptions.context)}return n}(),z=function(){function n(){}return n.prototype.transform=function(t){var i=[];return Object.keys(t.properties).forEach(function(e){t.properties[e].forEach(function(r){var o={message:r.message,groups:r.groups,always:r.always,each:r.each},s={type:r.type,name:r.name,target:t.name,propertyName:e,constraints:r.constraints,validationTypeOptions:r.options,validationOptions:o};i.push(new H(s))})}),i},n}();function Y(n){return n instanceof Map?Array.from(n.values()):Array.isArray(n)?n:Array.from(n)}function q(){if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global;if(typeof window<"u")return window;if(typeof self<"u")return self}function $(n){return n!==null&&typeof n=="object"&&typeof n.then=="function"}var K=globalThis&&globalThis.__values||function(n){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&n[t],e=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&e>=n.length&&(n=void 0),{value:n&&n[e++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},D=globalThis&&globalThis.__read||function(n,t){var i=typeof Symbol=="function"&&n[Symbol.iterator];if(!i)return n;var e=i.call(n),r,o=[],s;try{for(;(t===void 0||t-- >0)&&!(r=e.next()).done;)o.push(r.value)}catch(l){s={error:l}}finally{try{r&&!r.done&&(i=e.return)&&i.call(e)}finally{if(s)throw s.error}}return o},J=globalThis&&globalThis.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var e=0,r=t.length,o;e<r;e++)(o||!(e in t))&&(o||(o=Array.prototype.slice.call(t,0,e)),o[e]=t[e]);return n.concat(o||Array.prototype.slice.call(t))},Q=function(){function n(){this.validationMetadatas=new Map,this.constraintMetadatas=new Map}return Object.defineProperty(n.prototype,"hasValidationMetaData",{get:function(){return!!this.validationMetadatas.size},enumerable:!1,configurable:!0}),n.prototype.addValidationSchema=function(t){var i=this,e=new z().transform(t);e.forEach(function(r){return i.addValidationMetadata(r)})},n.prototype.addValidationMetadata=function(t){var i=this.validationMetadatas.get(t.target);i?i.push(t):this.validationMetadatas.set(t.target,[t])},n.prototype.addConstraintMetadata=function(t){var i=this.constraintMetadatas.get(t.target);i?i.push(t):this.constraintMetadatas.set(t.target,[t])},n.prototype.groupByPropertyName=function(t){var i={};return t.forEach(function(e){i[e.propertyName]||(i[e.propertyName]=[]),i[e.propertyName].push(e)}),i},n.prototype.getTargetValidationMetadatas=function(t,i,e,r,o){var s,l,f=function(c){return typeof c.always<"u"?c.always:c.groups&&c.groups.length?!1:e},a=function(c){return!!(r&&(!o||!o.length)&&c.groups&&c.groups.length)},u=this.validationMetadatas.get(t)||[],d=u.filter(function(c){return c.target!==t&&c.target!==i?!1:f(c)?!0:a(c)?!1:o&&o.length>0?c.groups&&!!c.groups.find(function(p){return o.indexOf(p)!==-1}):!0}),h=[];try{for(var v=K(this.validationMetadatas.entries()),g=v.next();!g.done;g=v.next()){var w=D(g.value,2),E=w[0],V=w[1];t.prototype instanceof E&&h.push.apply(h,J([],D(V),!1))}}catch(c){s={error:c}}finally{try{g&&!g.done&&(l=v.return)&&l.call(v)}finally{if(s)throw s.error}}var y=h.filter(function(c){return typeof c.target=="string"||c.target===t||c.target instanceof Function&&!(t.prototype instanceof c.target)?!1:f(c)?!0:a(c)?!1:o&&o.length>0?c.groups&&!!c.groups.find(function(p){return o.indexOf(p)!==-1}):!0}),N=y.filter(function(c){return!d.find(function(p){return p.propertyName===c.propertyName&&p.type===c.type})});return d.concat(N)},n.prototype.getTargetValidatorConstraints=function(t){return this.constraintMetadatas.get(t)||[]},n}();function X(){var n=q();return n.classValidatorMetadataStorage||(n.classValidatorMetadataStorage=new Q),n.classValidatorMetadataStorage}var L=function(){function n(){}return n.prototype.toString=function(t,i,e,r){var o=this;t===void 0&&(t=!1),i===void 0&&(i=!1),e===void 0&&(e=""),r===void 0&&(r=!1);var s=t?"\x1B[1m":"",l=t?"\x1B[22m":"",f=function(){var d;return(r?Object.values:Object.keys)((d=o.constraints)!==null&&d!==void 0?d:{}).join(", ")},a=function(d){return" - property ".concat(s).concat(e).concat(d).concat(l," has failed the following constraints: ").concat(s).concat(f()).concat(l,` 
`)};if(i){var u=Number.isInteger(+this.property)?"[".concat(this.property,"]"):"".concat(e?".":"").concat(this.property);return this.constraints?a(u):this.children?this.children.map(function(d){return d.toString(t,!0,"".concat(e).concat(u),r)}).join(""):""}else return"An instance of ".concat(s).concat(this.target?this.target.constructor.name:"an object").concat(l,` has failed the validation:
`)+(this.constraints?a(this.property):"")+(this.children?this.children.map(function(d){return d.toString(t,!0,o.property,r)}).join(""):"")},n}(),O=function(){function n(){}return n.isValid=function(t){var i=this;return t!=="isValid"&&t!=="getMessage"&&Object.keys(this).map(function(e){return i[e]}).indexOf(t)!==-1},n.CUSTOM_VALIDATION="customValidation",n.NESTED_VALIDATION="nestedValidation",n.PROMISE_VALIDATION="promiseValidation",n.CONDITIONAL_VALIDATION="conditionalValidation",n.WHITELIST="whitelistValidation",n.IS_DEFINED="isDefined",n}();function Z(n){return Array.isArray(n)?n.join(", "):(typeof n=="symbol"&&(n=n.description),"".concat(n))}var j=function(){function n(){}return n.replaceMessageSpecialTokens=function(t,i){var e;return t instanceof Function?e=t(i):typeof t=="string"&&(e=t),e&&Array.isArray(i.constraints)&&i.constraints.forEach(function(r,o){e=e.replace(new RegExp("\\$constraint".concat(o+1),"g"),Z(r))}),e&&i.value!==void 0&&i.value!==null&&["string","boolean","number"].includes(typeof i.value)&&(e=e.replace(/\$value/g,i.value)),e&&(e=e.replace(/\$property/g,i.property)),e&&(e=e.replace(/\$target/g,i.targetName)),e},n}(),_=globalThis&&globalThis.__read||function(n,t){var i=typeof Symbol=="function"&&n[Symbol.iterator];if(!i)return n;var e=i.call(n),r,o=[],s;try{for(;(t===void 0||t-- >0)&&!(r=e.next()).done;)o.push(r.value)}catch(l){s={error:l}}finally{try{r&&!r.done&&(i=e.return)&&i.call(e)}finally{if(s)throw s.error}}return o},F=function(){function n(t,i){this.validator=t,this.validatorOptions=i,this.awaitingPromises=[],this.ignoreAsyncValidations=!1,this.metadataStorage=X()}return n.prototype.execute=function(t,i,e){var r=this,o,s;!this.metadataStorage.hasValidationMetaData&&((o=this.validatorOptions)===null||o===void 0?void 0:o.enableDebugMessages)===!0&&console.warn(`No validation metadata found. No validation will be  performed. There are multiple possible reasons:
  - There may be multiple class-validator versions installed. You will need to flatten your dependencies to fix the issue.
  - This validation runs before any file with validation decorator was parsed by NodeJS.`);var l=this.validatorOptions?this.validatorOptions.groups:void 0,f=this.validatorOptions&&this.validatorOptions.strictGroups||!1,a=this.validatorOptions&&this.validatorOptions.always||!1,u=((s=this.validatorOptions)===null||s===void 0?void 0:s.forbidUnknownValues)===void 0||this.validatorOptions.forbidUnknownValues!==!1,d=this.metadataStorage.getTargetValidationMetadatas(t.constructor,i,a,f,l),h=this.metadataStorage.groupByPropertyName(d);if(this.validatorOptions&&u&&!d.length){var v=new L;(!this.validatorOptions||!this.validatorOptions.validationError||this.validatorOptions.validationError.target===void 0||this.validatorOptions.validationError.target===!0)&&(v.target=t),v.value=void 0,v.property=void 0,v.children=[],v.constraints={unknownValue:"an unknown value was passed to the validate function"},e.push(v);return}this.validatorOptions&&this.validatorOptions.whitelist&&this.whitelist(t,h,e),Object.keys(h).forEach(function(g){var w=t[g],E=h[g].filter(function(y){return y.type===O.IS_DEFINED}),V=h[g].filter(function(y){return y.type!==O.IS_DEFINED&&y.type!==O.WHITELIST});w instanceof Promise&&V.find(function(y){return y.type===O.PROMISE_VALIDATION})?r.awaitingPromises.push(w.then(function(y){r.performValidations(t,y,g,E,V,e)})):r.performValidations(t,w,g,E,V,e)})},n.prototype.whitelist=function(t,i,e){var r=this,o=[];Object.keys(t).forEach(function(s){(!i[s]||i[s].length===0)&&o.push(s)}),o.length>0&&(this.validatorOptions&&this.validatorOptions.forbidNonWhitelisted?o.forEach(function(s){var l,f=r.generateValidationError(t,t[s],s);f.constraints=(l={},l[O.WHITELIST]="property ".concat(s," should not exist"),l),f.children=void 0,e.push(f)}):o.forEach(function(s){return delete t[s]}))},n.prototype.stripEmptyErrors=function(t){var i=this;return t.filter(function(e){if(e.children&&(e.children=i.stripEmptyErrors(e.children)),Object.keys(e.constraints).length===0){if(e.children.length===0)return!1;delete e.constraints}return!0})},n.prototype.performValidations=function(t,i,e,r,o,s){var l=o.filter(function(h){return h.type===O.CUSTOM_VALIDATION}),f=o.filter(function(h){return h.type===O.NESTED_VALIDATION}),a=o.filter(function(h){return h.type===O.CONDITIONAL_VALIDATION}),u=this.generateValidationError(t,i,e);s.push(u);var d=this.conditionalValidations(t,i,a);!d||(this.customValidations(t,i,r,u),this.mapContexts(t,i,r,u),!(i===void 0&&this.validatorOptions&&this.validatorOptions.skipUndefinedProperties===!0)&&(i===null&&this.validatorOptions&&this.validatorOptions.skipNullProperties===!0||i==null&&this.validatorOptions&&this.validatorOptions.skipMissingProperties===!0||(this.customValidations(t,i,l,u),this.nestedValidations(i,f,u),this.mapContexts(t,i,o,u),this.mapContexts(t,i,l,u))))},n.prototype.generateValidationError=function(t,i,e){var r=new L;return(!this.validatorOptions||!this.validatorOptions.validationError||this.validatorOptions.validationError.target===void 0||this.validatorOptions.validationError.target===!0)&&(r.target=t),(!this.validatorOptions||!this.validatorOptions.validationError||this.validatorOptions.validationError.value===void 0||this.validatorOptions.validationError.value===!0)&&(r.value=i),r.property=e,r.children=[],r.constraints={},r},n.prototype.conditionalValidations=function(t,i,e){return e.map(function(r){return r.constraints[0](t,i)}).reduce(function(r,o){return r&&o},!0)},n.prototype.customValidations=function(t,i,e,r){var o=this;e.forEach(function(s){o.metadataStorage.getTargetValidatorConstraints(s.constraintCls).forEach(function(l){if(!(l.async&&o.ignoreAsyncValidations)&&!(o.validatorOptions&&o.validatorOptions.stopAtFirstError&&Object.keys(r.constraints||{}).length>0)){var f={targetName:t.constructor?t.constructor.name:void 0,property:s.propertyName,object:t,value:i,constraints:s.constraints};if(!s.each||!(Array.isArray(i)||i instanceof Set||i instanceof Map)){var a=l.instance.validate(i,f);if($(a)){var u=a.then(function(p){if(!p){var M=_(o.createValidationError(t,i,s,l),2),I=M[0],A=M[1];r.constraints[I]=A,s.context&&(r.contexts||(r.contexts={}),r.contexts[I]=Object.assign(r.contexts[I]||{},s.context))}});o.awaitingPromises.push(u)}else if(!a){var d=_(o.createValidationError(t,i,s,l),2),h=d[0],v=d[1];r.constraints[h]=v}return}var g=Y(i),w=g.map(function(p){return l.instance.validate(p,f)}),E=w.some(function(p){return $(p)});if(E){var V=w.map(function(p){return $(p)?p:Promise.resolve(p)}),y=Promise.all(V).then(function(p){var M=p.every(function(C){return C});if(!M){var I=_(o.createValidationError(t,i,s,l),2),A=I[0],U=I[1];r.constraints[A]=U,s.context&&(r.contexts||(r.contexts={}),r.contexts[A]=Object.assign(r.contexts[A]||{},s.context))}});o.awaitingPromises.push(y);return}var N=w.every(function(p){return p});if(!N){var c=_(o.createValidationError(t,i,s,l),2),h=c[0],v=c[1];r.constraints[h]=v}}})})},n.prototype.nestedValidations=function(t,i,e){var r=this;t!==void 0&&i.forEach(function(o){if(!(o.type!==O.NESTED_VALIDATION&&o.type!==O.PROMISE_VALIDATION)&&!(r.validatorOptions&&r.validatorOptions.stopAtFirstError&&Object.keys(e.constraints||{}).length>0))if(Array.isArray(t)||t instanceof Set||t instanceof Map){var s=t instanceof Set?Array.from(t):t;s.forEach(function(d,h){r.performValidations(t,d,h.toString(),[],i,e.children)})}else if(t instanceof Object){var l=typeof o.target=="string"?o.target:o.target.name;r.execute(t,l,e.children)}else{var f=_(r.createValidationError(o.target,t,o),2),a=f[0],u=f[1];e.constraints[a]=u}})},n.prototype.mapContexts=function(t,i,e,r){var o=this;return e.forEach(function(s){if(s.context){var l=void 0;if(s.type===O.CUSTOM_VALIDATION){var f=o.metadataStorage.getTargetValidatorConstraints(s.constraintCls);l=f[0]}var a=o.getConstraintType(s,l);r.constraints[a]&&(r.contexts||(r.contexts={}),r.contexts[a]=Object.assign(r.contexts[a]||{},s.context))}})},n.prototype.createValidationError=function(t,i,e,r){var o=t.constructor?t.constructor.name:void 0,s=this.getConstraintType(e,r),l={targetName:o,property:e.propertyName,object:t,value:i,constraints:e.constraints},f=e.message||"";!e.message&&(!this.validatorOptions||this.validatorOptions&&!this.validatorOptions.dismissDefaultMessages)&&r&&r.instance.defaultMessage instanceof Function&&(f=r.instance.defaultMessage(l));var a=j.replaceMessageSpecialTokens(f,l);return[s,a]},n.prototype.getConstraintType=function(t,i){var e=i&&i.name?i.name:t.type;return e},n}(),tt=globalThis&&globalThis.__awaiter||function(n,t,i,e){function r(o){return o instanceof i?o:new i(function(s){s(o)})}return new(i||(i=Promise))(function(o,s){function l(u){try{a(e.next(u))}catch(d){s(d)}}function f(u){try{a(e.throw(u))}catch(d){s(d)}}function a(u){u.done?o(u.value):r(u.value).then(l,f)}a((e=e.apply(n,t||[])).next())})},it=globalThis&&globalThis.__generator||function(n,t){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},e,r,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(u){return f([a,u])}}function f(a){if(e)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(e=1,r&&(o=a[0]&2?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){i=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(a[0]===6&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(n,i)}catch(u){a=[6,u],r=0}finally{e=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},R=function(){function n(){}return n.prototype.validate=function(t,i,e){return this.coreValidate(t,i,e)},n.prototype.validateOrReject=function(t,i,e){return tt(this,void 0,void 0,function(){var r;return it(this,function(o){switch(o.label){case 0:return[4,this.coreValidate(t,i,e)];case 1:return r=o.sent(),r.length?[2,Promise.reject(r)]:[2]}})})},n.prototype.validateSync=function(t,i,e){var r=typeof t=="string"?i:t,o=typeof t=="string"?e:i,s=typeof t=="string"?t:void 0,l=new F(this,o);l.ignoreAsyncValidations=!0;var f=[];return l.execute(r,s,f),l.stripEmptyErrors(f)},n.prototype.coreValidate=function(t,i,e){var r=typeof t=="string"?i:t,o=typeof t=="string"?e:i,s=typeof t=="string"?t:void 0,l=new F(this,o),f=[];return l.execute(r,s,f),Promise.all(l.awaitingPromises).then(function(){return l.stripEmptyErrors(f)})},n}(),nt=new(function(){function n(){this.instances=[]}return n.prototype.get=function(t){var i=this.instances.find(function(e){return e.type===t});return i||(i={type:t,object:new t},this.instances.push(i)),i.object},n}());function P(n){return nt.get(n)}function et(n,t,i){return typeof n=="string"?P(R).validate(n,t,i):P(R).validate(n,t)}class ct{errors=[];async validate(){const t=await et(this);for(const i of t)i.constraints;this.errors=t}clearValues(){for(const t in this)this.hasOwnProperty(t)&&typeof this[t]!="function"&&(this[t]=null)}}async function rt(n,t="get",i={}){const e=await W({url:n,method:t,...i.body?{data:i.body}:{},...i.headers?{headers:i.headers}:{},...i.params?{params:i.params}:{}}),r=e.status;if(![200,201,204].includes(r))throw new Error("Request failed",{cause:e.data});return e.data}let T;const ot=m("hospitality_bookings",{state:()=>({suiteBooking:[],autoBooking:[],tourBooking:[],visaBooking:[],currentSubscriberUserId:""}),getters:{},actions:{async initializeStore(){return console.log("initializing booking store",T),T||(T=await B(S.HOSPITALITY_BOOKINGS),console.log("initializing booking store 2",T)),this.$patch(T),T},async updateBooking(n,t){const i=this.$state[n];try{if(Array.isArray(i)){const e=i.findIndex(r=>r.id===t.id);e!==-1?i[e]=t:(t.id=new Date().getTime().toString(),i.push(t)),this.$patch({[n]:[...i]})}else this.$patch({[n]:t})}catch(e){console.log(e)}await b(S.HOSPITALITY_BOOKINGS,{...this.$state},e=>{console.log("An error occurred while trying to update booking store.",e)})},updateCurrentSubscribeUserId(n){this.$patch({currentSubscriberUserId:n})},getBooking(n){return this.$state[n]},async removeBooking(n,t){const i=this.$state[n],e=i.findIndex(r=>r.id===t);e!==-1&&(i.splice(e,1),this.$patch({[n]:[...i]}),await b(S.HOSPITALITY_BOOKINGS,{...this.$state},r=>{console.log("An error occurred while trying to update booking store.",r)}))},async clearBookingStore(){this.$reset(),T=null,await b(S.HOSPITALITY_BOOKINGS,{...this.$state},n=>{console.log("An error occurred while trying to clear booking store.",n)})}}});let x;const st=m("currentVals",{state:()=>({booking:0}),getters:{},actions:{async initializeStore(){return x||(x=await B(S.CURRENT_VALS)),console.log("initialise current vals",x),this.$patch(x),x},async updateBooking(n){this.$patch({booking:n}),console.log("currentVals",this.$state),await b(S.CURRENT_VALS,{...this.$state},t=>{console.log("An error occurred while trying to update currentVals store.",t)})}}});let k=[];const at=m("service_with_offers",{state:()=>k,getters:{},actions:{async initializeStore(){k.length===0&&(k=await B(S.SERVICE_WITH_OFFERS)),this.$state=k},getItem(n){return this.$state.find(i=>i.id===n)},async insertServices(n){if(!this.$state||this.$state.length===0)this.$state=n;else{for(const t of this.$state){const i=n.find(e=>e.id===t.id);i&&(n=n.filter(e=>e.id!==i.id))}n.length>0&&this.$state.concat(n)}await b(S.SERVICE_WITH_OFFERS,{...this.$state},t=>{console.log("An error occurred while trying to insert into service_with_offer store.",t)})},async insertServiceOfferIntoService(n,t){console.log("service offers to insert: ",t);const i=this.$state.find(e=>e.id===n);if(i)if(!i.offers||i.offers.length===0)i.offers=t,console.log("service offer inserted: ",i.offers);else{for(const e of i.offers){const r=t.find(o=>o.id===e.id);r&&(t=t.filter(o=>o.id!==r.id))}t.length>0&&i.offers.concat(t)}await b(S.SERVICE_WITH_OFFERS,{...this.$state},e=>{console.log("An error occurred while trying to insert into service_with_offer store.",e)})},async getServiceOffer(n){return this.$state.flatMap(e=>e.offers).find(e=>e.id===n)},async getAllServiceOffers(){let n=this.$state.flatMap(t=>t.offers);return console.log("from the servie offers present in state: ",n),n=n.filter(t=>t!==void 0),n}}});class ut{model;stores={};currentUser;constructor(t){this.model=t,this.stores.auth=G(),this.stores.bookings=ot(),this.stores.serviceWithOffer=at(),this.stores.currentVals=st(),this.currentUser={userData:this.stores.auth.userData,profile:this.stores.auth.profile}}async requestApi(...t){return rt(...t)}async validateModel(){var t,i;await((i=(t=this.model).validate)==null?void 0:i.call(t))}async invokevalidation(t){if(await this.validateModel(),this.model.errors&&this.model.errors.length>0){t==null||t(this.model.errors[0].toString());return}}}export{ct as B,Q as M,ut as V,X as a,O as b,H as c,P as g,rt as r};
